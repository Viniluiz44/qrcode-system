document.getElementById('scan').addEventListener('click', () => {
    const qrCodeScanner = new Html5Qrcode("reader");

    console.log("Inicializando leitor QR Code...");
    Html5Qrcode.getCameras().then(cameras => {
        if (cameras.length > 0) {
            // Procura pela câmera traseira (environment)
            const rearCamera = cameras.find(camera => camera.label.toLowerCase().includes('back')) || cameras[0];
            qrCodeScanner.start(
                { deviceId: { exact: rearCamera.id } }, // Usa a câmera identificada
                {
                    fps: 10, // Frames por segundo
                    qrbox: 250 // Tamanho do box de leitura
                },
                (decodedText) => {
                    console.log("QR Code lido com sucesso:", decodedText);
                    document.getElementById("qr_code").value = decodedText;
                    qrCodeScanner.stop();
                    document.getElementById("reader").style.display = "none";
                },
                (errorMessage) => {
                    console.log("Erro durante a leitura:", errorMessage);
                }
            ).catch((err) => {
                console.error("Erro ao acessar a câmera:", err);
                alert("Não foi possível acessar a câmera. Verifique as permissões no navegador.");
            });

            document.getElementById("reader").style.display = "block";
        } else {
            console.error("Nenhuma câmera encontrada.");
            alert("Nenhuma câmera foi encontrada no dispositivo.");
        }
    }).catch(err => {
        console.error("Erro ao obter a lista de câmeras:", err);
        alert("Erro ao obter a lista de câmeras. Verifique as permissões no navegador.");
    });
});
